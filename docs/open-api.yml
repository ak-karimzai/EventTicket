openapi: 3.0.0
info:
  title: Events Management API
  description: RESTful API for managing users, categories, events, tickets, orders, and order items.
  version: 1.0.0

servers:
  - url: https://api.example.com
    description: Production server

tags:
  - name: categories
    description: Endpoints related to categories
  - name: events
    description: Endpoints related to events
  - name: users
    description: Endpoints related to users
  - name: orders
    description: Endpoints related to orders
  - name: tickets
    description: Endpoints related to tickets

paths:
  /users:
    get:
      tags:
        - users
      summary: Retrieve a list of users
      responses:
        '200':
          description: A list of users.
    post:
      tags:
        - users
      summary: Create a new user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '#/components/schemas/UserDto'
      responses:
        '201':
          description: User created successfully.

  /users/{id}:
    get:
      tags:
        - users
      summary: Retrieve a user by ID
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: User retrieved successfully.
        '401':
          description: Unauthorized.
        '403':
          description: Permission denied.
    put:
      tags:
        - users
      summary: Update a user by ID
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateUserCommand'
      responses:
        '200':
          description: User updated successfully.
        '401':
          description: Unauthorized.
        '403':
          description: Permission denied.
    delete:
      tags:
        - users
      summary: Delete a user by ID
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        '204':
          description: User deleted successfully.

  /categories:
    get:
      summary: Retrieve a list of categories
      tags:
        - categories
      responses:
        '200':
          description: A list of categories.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/CategoryDto'
      
    post:
      summary: Create a new category
      tags:
        - categories
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateCategoryCommand'
      responses:
        '201':
          description: Category created successfully.
        '401':
          description: Unauthorized.
        '403':
          description: Permission denied.
  /categories/{categoryId}:
    put:
      tags:
        - categories
      parameters:
        - in: path
          name: categoryId
          schema:
            type: integer
          required: true
      summary: Update an existing category
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateCategoryCommand'
      responses:
        '201':
          description: Category created successfully.

  /categories/{categoryId}/events:
    get:
      tags:
        - categories
      parameters:
        - in: path
          name: categoryId
          schema:
            type: integer
          required: true
      summary: Retrieve a list of events
      responses:
        '200':
          description: A list of events.
    post:
      tags:
        - events
      summary: Create a new event
      parameters:
        - in: path
          name: categoryId
          schema:
            type: integer
          required: true
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateEventCommand'
      responses:
        '201':
          description: Event created successfully.

  /categories/{categoryId}/events/{eventId}/tickets:
    get:
      tags:
        - tickets
      parameters:
        - in: path
          name: categoryId
          schema:
            type: integer
          required: true
        - in: path
          name: eventId
          schema:
            type: integer
          required: true
      summary: Retrieve a list of tickets
      responses:
        '200':
          description: A list of tickets.
    post:
      tags:
        - tickets
      parameters:
        - in: path
          name: categoryId
          schema:
            type: integer
          required: true
        - in: path
          name: eventId
          schema:
            type: integer
          required: true
      summary: Create a new ticket
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateTicketCommand'
      responses:
        '201':
          description: Ticket created successfully.

  /orders:
    get:
      tags:
        - orders
      summary: Retrieve a list of orders
      responses:
        '200':
          description: A list of orders.
    post:
      tags:
        - orders
      summary: Place a new order
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateOrderCommand'
      responses:
        '201':
          description: Order placed successfully.

  /orders/{orderId}/items:
    get:
      tags:
        - orders
      parameters:
        - in: path
          name: orderId
          schema:
            type: integer
          required: true
      summary: Retrieve a list of order items
      responses:
        '200':
          description: A list of order items.
        '401':
          description: Unauthorized.
        '403':
          description: Permission denied
    post:
      tags:
        - orders
      parameters:
        - in: path
          name: orderId
          schema:
            type: integer
          required: true
      summary: Add an item to an order
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddItemCommand'
      responses:
        '201':
          description: Order item created successfully.
        '401':
          description: Unauthorized.
        '403':
          description: Permission denied

components:
  schemas:
    RegisterCommand:
      type: object
      properties:
        name:
          type: string
          description: Name of the user.
        email:
          type: string
          description: Email of the user.
        phone_number:
          type: string
          description: Phone number of the user.
        username:
          type: string
          description: Username of the user.
        password:
          type: string
          description: Password of the user.
    
    LoginCommand:
      type: object
      properties:
        username:
          type: string
          description: Username of the user.
        password:
          type: string
          description: Password of the user.
          
    UpdateUserCommand:
        name:
          type: string
          description: Name of the user.
        email:
          type: string
          description: Email of the user.
        phone_number:
          type: string
          description: Phone number of the user.
        username:
          type: string
          description: Username of the user.
        password:
          type: string
          description: Password of the user.
        
    UserDto:
      type: object
      properties:
        id:
          type: integer
          description: Unique identifier for the user.
        name:
          type: string
          description: Name of the user.
        email:
          type: string
          description: Email of the user.
        phone_number:
          type: string
          description: Phone number of the user.
        username:
          type: string
          description: Username of the user.
        role:
          type: string
          description: Role of the user.
        joined_at:
          type: string
          format: date-time
          description: Date the user joined.
          
    CreateCategoryCommand:
      type: object
      properties:
        title:
          type: string
          description: Title of the category.
    
    UpdateCategoryCommand:
      type: object
      properties:
        title:
          type: string
          description: New title of the category.

    CategoryDto:
      type: object
      properties:
        id:
          type: integer
          description: Unique identifier for the category.
        title:
          type: string
          description: Title of the category.
          
    CreateEventCommand:
      type: object
      properties:
        title:
          type: string
          description: Title of the event.
        artist:
          type: string
          description: Name of the artist for the event.
        date:
          type: string
          format: date-time
          description: Date and time of the event.
        description:
          type: string
          description: Description of the event.
        category:
          $ref: '#/components/schemas/CategoryDto'
          description: Category of the the event belongs to.
        created_date:
          type: string
          format: date-time
          description: Date the event was created.
        last_modified_date:
          type: string
          format: date-time
          description: Date the event was last modified.
      
    UpdateEventCommand:
      type: object
      properties:
        title:
          type: string
          description: Title of the event.
        artist:
          type: string
          description: Name of the artist for the event.
        date:
          type: string
          format: date-time
          description: Date and time of the event.
        description:
          type: string
          description: Description of the event.
        category:
          $ref: '#/components/schemas/CategoryDto'
          description: Category of the the event belongs to.
        created_date:
          type: string
          format: date-time
          description: Date the event was created.
        last_modified_date:
          type: string
          format: date-time
          description: Date the event was last modified.
    
    EventDto:
      type: object
      properties:
        id:
          type: integer
          description: Unique identifier for the event.
        title:
          type: string
          description: Title of the event.
        artist:
          type: string
          description: Name of the artist for the event.
        date:
          type: string
          format: date-time
          description: Date and time of the event.
        description:
          type: string
          description: Description of the event.
        category:
          $ref: '#/components/schemas/CategoryDto'
          description: Category of the the event belongs to.
        created_date:
          type: string
          format: date-time
          description: Date the event was created.
        last_modified_date:
          type: string
          format: date-time
          description: Date the event was last modified.
          
    CreateTicketCommand:
      type: object
      properties:
        title:
          type: string
          description: Title of the ticket.
        description:
          type: string
          description: Description of the ticket.
        price:
          type: number
          format: float
          description: Price of the ticket.
        event_id:
          type: integer
          description: event identifier for the ticket.
    
    UpdateTicketCommand:
      type: object
      properties:
        title:
          type: string
          description: Title of the ticket.
        description:
          type: string
          description: Description of the ticket.
        price:
          type: number
          format: float
          description: Price of the ticket.
        event_id:
          type: integer
          description: event identifier for the ticket.
    
    TicketDto:
      type: object
      properties:
        id:
          type: integer
          description: Unique identifier for the ticket.
        title:
          type: string
          description: Title of the ticket.
        description:
          type: string
          description: Description of the ticket.
        price:
          type: number
          format: float
          description: Price of the ticket.
        event:
          $ref: '#/components/schemas/EventDto'
          description: Event of the the ticker belongs to.
        created_date:
          type: string
          format: date-time
          description: Date the ticket was created.
        last_modified_date:
          type: string
          format: date-time
          description: Date the ticket was last modified.
    
    CreateOrderCommand:
      type: object
      properties:
        items:
          type: array
          items: 
            $ref: '#/components/schemas/OrderItemDto'
    
    UpdateOrderCommand:
      type: object
      properties:
        items:
          type: array
          items: 
            $ref: '#/components/schemas/OrderItemDto'
    
    OrderDto:
      type: object
      properties:
        id:
          type: integer
          description: Unique identifier for the order.
        order_placed:
          type: string
          format: date-time
          description: Date the order was placed.
        items:
          type: array
          items: 
            $ref: '#/components/schemas/OrderItemDto'
        order_paid:
          type: boolean
          description: Whether the order has been paid.
    
    AddItemCommand:
      type: object
      properties:
        ticket_id:
          type: integer
          description: Ticket id.
        amount:
          type: integer
          description: Amount of ticket

    OrderItemDto:
      type: object
      properties:
        id:
          type: integer
          description: Unique identifier for the order item.
        ticket:
          $ref: '#/components/schemas/TicketDto'
          description: ticket of the order.
        amount:
          type: integer
          description: Quantity of the ticket in the order.